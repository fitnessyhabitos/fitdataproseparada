<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FIT DATA">
    <meta name="theme-color" content="#050505">
    <title>FIT DATA - Training & Coach</title>
    <link rel="icon" href="logo.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- PANTALLA DE CARGA -->
<div id="loading-screen">
    <img id="loading-logo" src="logo.png" alt="Loading">
    <div class="loading-text">CARGANDO...</div>
</div>

<!-- HEADER SUPERIOR (SIEMPRE VISIBLE EN DESKTOP, SOLO COACH EN M√ìVIL) -->
<header id="main-header" class="main-header hidden">
    <div class="brand">
        <img class="header-logo" src="logo.png" alt="Logo">
        <span>FIT</span>DATA
    </div>
    <div class="header-actions" id="header-actions">
        <!-- COACH (SOLO VISIBLE PARA COACH/ADMIN) - SIEMPRE EN TOP -->
        <div id="top-btn-coach" class="top-nav-item hidden" onclick="window.switchTab('admin-view')">
            <div class="top-icon">üèÜ</div>
            <div class="top-label">Coach</div>
        </div>
        
        <!-- RUTINAS Y PERFIL (EN DESKTOP AQU√ç, EN M√ìVIL ARRIBA A LA DERECHA) -->
        <div id="top-btn-routines" class="top-nav-item desktop-only" onclick="window.switchTab('routines-view')">
            <div class="top-icon">üìã</div>
            <div class="top-label">Rutinas</div>
        </div>
        <div id="top-btn-profile" class="top-nav-item desktop-only" onclick="window.switchTab('profile-view')">
            <div class="top-icon">üë§</div>
            <div class="top-label">Perfil</div>
        </div>
        
        <!-- NOTIFICACI√ìN -->
        <div id="notif-badge" class="notif-badge" onclick="window.dismissNotif()"></div>
    </div>
</header>

<!-- CONTENEDOR PRINCIPAL (CON SCROLL INTERNO) -->
<div id="main-container" class="main-container">
    
    <!-- AUTH VIEW -->
    <div id="auth-view" class="view-container">
        <div style="margin-top: 40px;">
            
            <!-- LOGIN FORM -->
            <div id="login-form">
                <div style="text-align: center; margin-bottom: 30px;">
                    <img src="logo.png" style="width: 80px; border-radius: 12px; box-shadow: 0 0 20px rgba(255,51,51,0.4);">
                    <h1 style="margin-top: 15px; font-family: 'Russo One'; letter-spacing: 2px;">FIT DATA</h1>
                    <p style="color: #888; font-size: 0.9rem;">Entrena como un Campe√≥n</p>
                </div>
                
                <input type="email" id="login-email" placeholder="Tu email" required>
                <input type="password" id="login-password" placeholder="Contrase√±a" required>
                <button class="btn" onclick="window.handleLogin()">ENTRAR</button>
                <button class="btn-outline" onclick="window.toggleAuth('register')">¬øSin cuenta? Reg√≠strate</button>
                <div class="link-text" onclick="window.recoverPass()">¬øOlvidaste la contrase√±a?</div>
            </div>
            
            <!-- REGISTER FORM -->
            <div id="register-form" class="hidden">
                <h2 style="text-align: center; margin-bottom: 20px;">CREAR CUENTA</h2>
                <input type="email" id="register-email" placeholder="Tu email" required>
                <input type="password" id="register-password" placeholder="Contrase√±a" required>
                <input type="password" id="register-confirm" placeholder="Confirmar contrase√±a" required>
                <select id="register-role">
                    <option value="athlete">Atleta</option>
                    <option value="coach">Coach</option>
                </select>
                <button class="btn" onclick="window.handleRegister()">REGISTRARSE</button>
                <button class="btn-outline" onclick="window.toggleAuth('login')">Ya tengo cuenta</button>
            </div>
        </div>
    </div>
    
    <!-- ROUTINES VIEW -->
    <div id="routines-view" class="view-container">
        <h2 style="margin-bottom: 20px;">MIS RUTINAS</h2>
        <button class="btn" onclick="window.openEditor()" style="margin-bottom: 20px;">+ NUEVA RUTINA</button>
        <div id="routines-list">Cargando...</div>
    </div>
    
    <!-- PROFILE VIEW -->
    <div id="profile-view" class="view-container">
        <h2 style="margin-bottom: 20px;">üë§ MI PERFIL</h2>
        <div class="profile-header">
            <div class="avatar-circle">
                <img id="profile-avatar" src="logo.png" alt="Avatar">
            </div>
            <div>
                <div id="profile-name" style="font-size: 1.2rem; font-weight: bold;">Atleta de Alto Rendimiento</div>
                <div id="profile-role" style="color: #888; font-size: 0.9rem;">Cargando...</div>
            </div>
        </div>
        
        <h3>HISTORIAL RECIENTE</h3>
        <div id="history-list">Cargando...</div>
        
        <h3 style="margin-top: 25px;">ESTAD√çSTICAS TOTALES</h3>
        <div class="stats-grid">
            <div class="stat-box">
                <span class="stat-num" id="stat-workouts">0</span>
                <span class="stat-label">Entrenos</span>
            </div>
            <div class="stat-box">
                <span class="stat-num" id="stat-kg">0</span>
                <span class="stat-label">Kg Movidos</span>
            </div>
            <div class="stat-box">
                <span class="stat-num" id="stat-series">0</span>
                <span class="stat-label">Series</span>
            </div>
            <div class="stat-box">
                <span class="stat-num" id="stat-reps">0</span>
                <span class="stat-label">Reps</span>
            </div>
        </div>
        
        <h3 style="margin-top: 25px;">MAPA MUSCULAR</h3>
        <div id="muscle-chart-container"></div>
        
        <h3 style="margin-top: 25px;">EVOLUCI√ìN F√çSICA</h3>
        <div class="tip-box">üí° TIP: Usa siempre la misma luz, ropa y lugar.</div>
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button class="btn-outline" style="width: 100%; margin: 0; padding: 8px;" onclick="window.switchPhotoTab('front')">üë§ FRONTAL</button>
            <button class="btn-outline" style="width: 100%; margin: 0; padding: 8px;" onclick="window.switchPhotoTab('back')">üõ°Ô∏è ESPALDA</button>
        </div>
        <div id="photo-comparison"></div>
        
        <h3 style="margin-top: 25px;">PESO CORPORAL</h3>
        <div id="weight-chart-container"></div>
        
        <h3 style="margin-top: 25px;">CONFIGURACI√ìN</h3>
        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <span>Mostrar Pliegues</span>
            <div class="switch">
                <input type="checkbox" id="show-skinfolds" onchange="window.updateUserSettings()">
                <span class="slider"></span>
            </div>
        </label>
        
        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <span>Mostrar Medidas</span>
            <div class="switch">
                <input type="checkbox" id="show-measures" onchange="window.updateUserSettings()">
                <span class="slider"></span>
            </div>
        </label>
        
        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <span>Tiempo Descanso (s)</span>
            <input type="number" id="rest-time" min="10" max="600" style="width: 80px; margin: 0;" onchange="window.updateUserSettings()">
        </label>
        
        <div class="tip-box" style="margin-top: 10px;">Para que vibre el reloj al acabar el descanso</div>
        
        <label style="display: flex; align-items: center; gap: 10px; margin: 15px 0;">
            <span>Recordatorio Fotos:</span>
            <select id="photo-day" style="flex: 1; margin: 0;" onchange="window.updateUserSettings()">
                <option value="">Desactivado</option>
                <option value="0">Domingo</option>
                <option value="1">Lunes</option>
                <option value="2">Martes</option>
                <option value="3">Mi√©rcoles</option>
                <option value="4">Jueves</option>
                <option value="5">Viernes</option>
                <option value="6">S√°bado</option>
            </select>
        </label>
        
        <label style="display: flex; align-items: center; gap: 10px; margin: 15px 0;">
            <span>Hora:</span>
            <input type="time" id="photo-time" style="flex: 1; margin: 0;" onchange="window.updateUserSettings()">
        </label>
        
        <label style="display: flex; align-items: center; gap: 10px; margin: 15px 0;">
            <span>Sonido (5 Beeps)</span>
            <div class="switch">
                <input type="checkbox" id="enable-sound" checked>
                <span class="slider"></span>
            </div>
        </label>
        
        <label style="display: flex; align-items: center; gap: 10px; margin: 15px 0;">
            <span>Pantalla Activa</span>
            <div class="switch">
                <input type="checkbox" id="keep-awake" onchange="window.toggleWakeLock()">
                <span class="slider"></span>
            </div>
        </label>
        
        <button class="btn" onclick="window.enableNotifications()" style="margin-top: 20px;">üîî ACTIVAR NOTIFICACIONES</button>
        <button class="btn btn-danger" onclick="window.logout()" style="margin-top: 20px;">CERRAR SESI√ìN</button>
    </div>
    
    <!-- WORKOUT VIEW -->
    <div id="workout-view" class="view-container">
        <div style="text-align: center; margin-bottom: 15px;">
            <div style="font-size: 2rem; font-weight: bold; color: var(--accent-color);">
                <span id="timer-main">00:00</span>
            </div>
            <div style="font-size: 0.9rem; color: #888; margin-top: 5px;">
                REST: <span id="rest-counter">00:00</span>
            </div>
        </div>
        <div id="workout-content"></div>
    </div>
    
    <!-- EDITOR VIEW -->
    <div id="editor-view" class="view-container">
        <div class="sticky-editor-header">
            <h2 id="editor-title" style="text-align: center;">NUEVA RUTINA</h2>
        </div>
        <input type="text" id="editor-name" placeholder="Nombre de la rutina" style="margin-bottom: 15px;">
        
        <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">Buscar Ejercicios</label>
            <input type="text" placeholder="Escribe para buscar..." onkeyup="window.filterExercises(this.value)">
        </div>
        
        <div id="selected-summary" class="selected-summary"></div>
        
        <h3 style="margin: 20px 0 10px 0;">EJERCICIOS DISPONIBLES</h3>
        <div id="exercise-selector-list">Cargando...</div>
        
        <button class="btn btn-success" onclick="window.saveRoutine()" style="margin-top: 20px;">GUARDAR RUTINA</button>
        <button class="btn-outline" onclick="window.switchTab('routines-view')" style="margin-top: 10px;">VOLVER</button>
    </div>
    
    <!-- ADMIN VIEW (PANEL COACH) -->
    <div id="admin-view" class="view-container">
        <h2 style="margin-bottom: 20px;">üèÜ PANEL COACH</h2>
        
        <div class="admin-tabs">
            <button class="admin-tab-btn active" onclick="window.switchAdminTab('athletes')">üë• ATLETAS</button>
            <button class="admin-tab-btn" onclick="window.switchAdminTab('library')">üìö LIBRER√çA</button>
        </div>
        
        <div id="athletes-tab" class="admin-tab-content active">
            <h3>Lista de Atletas</h3>
            <div id="athletes-list">Cargando...</div>
        </div>
        
        <div id="library-tab" class="admin-tab-content hidden">
            <h3>Librer√≠a de Rutinas</h3>
            <div id="library-list">Cargando...</div>
        </div>
    </div>
    
    <!-- COACH DETAIL VIEW -->
    <div id="coach-detail-view" class="view-container">
        <button class="btn-outline" onclick="window.switchTab('admin-view')" style="margin-bottom: 15px;">‚Üê VOLVER</button>
        
        <div class="profile-header">
            <div class="avatar-circle">
                <img id="coach-detail-avatar" src="logo.png" alt="Avatar">
            </div>
            <div>
                <div id="coach-detail-name" style="font-size: 1.2rem; font-weight: bold;">Nombre Atleta</div>
                <div id="coach-detail-email" style="color: #888; font-size: 0.9rem;">email@example.com</div>
            </div>
        </div>
        
        <h3>‚öôÔ∏è CONFIGURACI√ìN ATLETA</h3>
        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <span>Habilitar Pliegues</span>
            <div class="switch">
                <input type="checkbox" id="coach-skinfolds" onchange="window.updateCoachUserSettings()">
                <span class="slider"></span>
            </div>
        </label>
        
        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <span>Habilitar Medidas</span>
            <div class="switch">
                <input type="checkbox" id="coach-measures" onchange="window.updateCoachUserSettings()">
                <span class="slider"></span>
            </div>
        </label>
        
        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
            <span>Habilitar V√≠deos (YouTube)</span>
            <div class="switch">
                <input type="checkbox" id="coach-videos" onchange="window.updateCoachUserSettings()">
                <span class="slider"></span>
            </div>
        </label>
        
        <h3 style="margin-top: 25px;">üì∏ FOTOS</h3>
        <div class="coach-photos-row">
            <div class="coach-photo-box">
                <img id="coach-photo-front" src="logo.png" alt="Frontal">
                <div class="photo-date-label" id="coach-photo-front-date"></div>
            </div>
            <div class="coach-photo-box">
                <img id="coach-photo-back" src="logo.png" alt="Espalda">
                <div class="photo-date-label" id="coach-photo-back-date"></div>
            </div>
        </div>
        
        <h3 style="margin-top: 25px;">GR√ÅFICA PESO</h3>
        <div id="coach-weight-chart"></div>
        
        <h3 style="margin-top: 25px;">RUTINAS ASIGNADAS</h3>
        <div id="coach-assigned-routines">Cargando...</div>
    </div>
    
</div>

<!-- BARRA INFERIOR (M√ìVIL) - CON SAFE AREA INSET -->
<nav id="bottom-nav" class="bottom-nav mobile-only">
    <div class="bottom-nav-item" onclick="window.switchTab('routines-view')">
        <div class="bottom-icon">üìã</div>
        <div class="bottom-label">Rutinas</div>
    </div>
    <div class="bottom-nav-item" onclick="window.switchTab('profile-view')">
        <div class="bottom-icon">üë§</div>
        <div class="bottom-label">Perfil</div>
    </div>
</nav>

<script type="module" src="app.js"></script>
</body>
</html>